import{r as o,R as h}from"./react-VWm1Us2J.js";import{_ as N,a as Oe}from"./@babel-C_WqewBV.js";import{F as Ge,a as Be,m as Y,f as Z,b as Me,c as _e,d as He,e as $e,g as ee,h as Ne,i as Te,j as De}from"./focus-lock-C9IILf04.js";import{c as T,a as Ue}from"./use-sidecar-DbH-p37w.js";import{u as je}from"./use-callback-ref-Dzb8UhFM.js";import{w as Ae}from"./react-clientside-effect-HNziPaXB.js";var $={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},te=T({},function(r){var e=r.target,t=r.currentTarget;return{target:e,currentTarget:t}}),re=T(),qe=T(),Ve=Ue({async:!0,ssr:typeof document<"u"}),ze=o.createContext(void 0),Je=[],ne=o.forwardRef(function(e,t){var n,u=o.useState(),s=u[0],m=u[1],F=o.useRef(),p=o.useRef(!1),g=o.useRef(null),S=o.useState({}),I=S[1],c=e.children,b=e.disabled,d=b===void 0?!1:b,k=e.noFocusGuards,f=k===void 0?!1:k,E=e.persistentFocus,l=E===void 0?!1:E,i=e.crossFrame,C=i===void 0?!0:i,W=e.autoFocus,B=W===void 0?!0:W;e.allowTextSelection;var le=e.group,ve=e.className,me=e.whiteList,Fe=e.hasPositiveIndices,A=e.shards,M=A===void 0?Je:A,q=e.as,be=q===void 0?"div":q,V=e.lockProps,he=V===void 0?{}:V,pe=e.sideCar,z=e.returnFocus,O=z===void 0?!1:z,ge=e.focusOptions,_=e.onActivation,H=e.onDeactivation,ye=o.useState({}),Ee=ye[0],Ce=o.useCallback(function(v){var L=v.captureFocusRestore;if(!g.current){var P,y=(P=document)==null?void 0:P.activeElement;g.current=y,y!==document.body&&(g.current=L(y))}F.current&&_&&_(F.current),p.current=!0,I()},[_]),Le=o.useCallback(function(){p.current=!1,H&&H(F.current),I()},[H]),Pe=o.useCallback(function(v){var L=g.current;if(L){var P=(typeof L=="function"?L():L)||document.body,y=typeof O=="function"?O(P):O;if(y){var K=typeof y=="object"?y:void 0;g.current=null,v?Promise.resolve().then(function(){return P.focus(K)}):P.focus(K)}}},[O]),we=o.useCallback(function(v){p.current&&te.useMedium(v)},[]),xe=re.useMedium,Se=o.useCallback(function(v){F.current!==v&&(F.current=v,m(v))},[]),Ie=N((n={},n[Ge]=d&&"disabled",n[Be]=le,n),he),J=f!==!0,Re=J&&f!=="tail",ke=je([t,Se]),We=o.useMemo(function(){return{observed:F,shards:M,enabled:!d,active:p.current}},[d,p.current,M,s]);return h.createElement(o.Fragment,null,J&&[h.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:d?-1:0,style:$}),Fe?h.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:d?-1:1,style:$}):null],!d&&h.createElement(pe,{id:Ee,sideCar:Ve,observed:s,disabled:d,persistentFocus:l,crossFrame:C,autoFocus:B,whiteList:me,shards:M,onActivation:Ce,onDeactivation:Le,returnFocus:Pe,focusOptions:ge,noFocusGuards:f}),h.createElement(be,N({ref:ke},Ie,{className:ve,onBlur:xe,onFocus:we}),h.createElement(ze.Provider,{value:We},c)),Re&&h.createElement("div",{"data-focus-guard":!0,tabIndex:d?-1:0,style:$}))});ne.propTypes={};const oe=ne;function D(r){setTimeout(r,1)}var Ke=function(e){return e&&"current"in e?e.current:e},ae=function(){return document&&document.activeElement===document.body},Qe=function(){return ae()||Te()},w=null,a=null,Q=function(){return null},x=null,R=!1,U=!1,Xe=function(){return!0},Ye=function(e){return(w.whiteList||Xe)(e)},Ze=function(e,t){x={observerNode:e,portaledElement:t}},et=function(e){return x&&x.portaledElement===e};function X(r,e,t,n){var u=null,s=r;do{var m=n[s];if(m.guard)m.node.dataset.focusAutoGuard&&(u=m);else if(m.lockItem){if(s!==r)return;u=null}else break}while((s+=t)!==e);u&&(u.node.tabIndex=0)}var tt=function(e){return e?!!R:R==="meanwhile"},rt=function r(e,t,n){return t&&(t.host===e&&(!t.activeElement||n.contains(t.activeElement))||t.parentNode&&r(e,t.parentNode,n))},nt=function(e,t){return t.some(function(n){return rt(e,n,n)})},ue=function(e){return De(e,new Map)},ot=function(e){return!ue([e.parentNode]).some(function(t){return t.node===e})},G=function(){var e=!1;if(w){var t=w,n=t.observed,u=t.persistentFocus,s=t.autoFocus,m=t.shards,F=t.crossFrame,p=t.focusOptions,g=t.noFocusGuards,S=n||x&&x.portaledElement;if(ae()&&a&&a!==document.body&&(!document.body.contains(a)||ot(a))){var I=Q();I&&I.focus()}var c=document&&document.activeElement;if(S){var b=[S].concat(m.map(Ke).filter(Boolean)),d=function(){if(!tt(F)||!g||!a||U)return!1;var i=ue(b),C=i.findIndex(function(W){var B=W.node;return B===a});return C===0||C===i.length-1};if((!c||Ye(c))&&(u||d()||!Qe()||!a&&s)&&(S&&!(Z(b)||c&&nt(c,b)||et(c))&&(document&&!a&&c&&!s?(c.blur&&c.blur(),document.body.focus()):(e=Y(b,a,{focusOptions:p}),x={})),a=document&&document.activeElement,a!==document.body&&(Q=ee(a)),R=!1),document&&c!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var k=document&&document.activeElement,f=Ne(b),E=f.map(function(l){var i=l.node;return i}).indexOf(k);E>-1&&(f.filter(function(l){var i=l.guard,C=l.node;return i&&C.dataset.focusAutoGuard}).forEach(function(l){var i=l.node;return i.removeAttribute("tabIndex")}),X(E,f.length,1,f),X(E,-1,-1,f))}}}return e},se=function(e){G()&&e&&(e.stopPropagation(),e.preventDefault())},j=function(){return D(G)},at=function(e){var t=e.target,n=e.currentTarget;n.contains(t)||Ze(n,t)},ut=function(){return null},ce=function(){U=!0},ie=function(){U=!1,R="just",D(function(){R="meanwhile"})},st=function(){document.addEventListener("focusin",se),document.addEventListener("focusout",j),window.addEventListener("focus",ce),window.addEventListener("blur",ie)},ct=function(){document.removeEventListener("focusin",se),document.removeEventListener("focusout",j),window.removeEventListener("focus",ce),window.removeEventListener("blur",ie)};function it(r){return r.filter(function(e){var t=e.disabled;return!t})}var de={moveFocusInside:Y,focusInside:Z,focusNextElement:Me,focusPrevElement:_e,focusFirstElement:He,focusLastElement:$e,captureFocusRestore:ee};function dt(r){var e=r.slice(-1)[0];e&&!w&&st();var t=w,n=t&&e&&e.id===t.id;w=e,t&&!n&&(t.onDeactivation(),r.filter(function(u){var s=u.id;return s===t.id}).length||t.returnFocus(!e)),e?(a=null,(!n||t.observed!==e.observed)&&e.onActivation(de),G(),D(G)):(ct(),a=null)}te.assignSyncMedium(at);re.assignMedium(j);qe.assignMedium(function(r){return r(de)});const ft=Ae(it,dt)(ut);var lt=o.forwardRef(function(e,t){return h.createElement(oe,N({sideCar:ft,ref:t},e))}),fe=oe.propTypes||{};fe.sideCar;Oe(fe,["sideCar"]);lt.propTypes={};export{lt as F};
