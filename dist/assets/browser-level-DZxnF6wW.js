import{a as q}from"./abstract-level-C44ku3Pl.js";import{m as $}from"./module-error-Ch16hYGc.js";import{r as F}from"./run-parallel-limit-CWkkA9tx.js";import{c as N}from"./catering-DDE1aTSv.js";var O={},P=function(e){const n=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,t=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,s=e.gte===void 0,r=e.lte===void 0;return n!==void 0&&t!==void 0?IDBKeyRange.bound(n,t,s,r):n!==void 0?IDBKeyRange.lowerBound(n,s):t!==void 0?IDBKeyRange.upperBound(t,r):null};const U=new TextEncoder;var j=function(l){return l instanceof Uint8Array?l:l instanceof ArrayBuffer?new Uint8Array(l):U.encode(l)};const{AbstractIterator:V}=q,L=P,k=j,y=Symbol("cache"),m=Symbol("finished"),a=Symbol("options"),g=Symbol("currentOptions"),v=Symbol("position"),S=Symbol("location"),w=Symbol("first"),K={};let G=class extends V{constructor(e,n,t){super(e,t),this[y]=[],this[m]=this.limit===0,this[a]=t,this[g]={...t},this[v]=void 0,this[S]=n,this[w]=!0}_nextv(e,n,t){if(this[w]=!1,this[m])return this.nextTick(t,null,[]);if(this[y].length>0)return e=Math.min(e,this[y].length),this.nextTick(t,null,this[y].splice(0,e));this[v]!==void 0&&(this[a].reverse?(this[g].lt=this[v],this[g].lte=void 0):(this[g].gt=this[v],this[g].gte=void 0));let s;try{s=L(this[g])}catch{return this[m]=!0,this.nextTick(t,null,[])}const r=this.db.db.transaction([this[S]],"readonly"),i=r.objectStore(this[S]),o=[];if(this[a].reverse){const c=!this[a].values&&i.openKeyCursor?"openKeyCursor":"openCursor";i[c](s,"prev").onsuccess=u=>{const d=u.target.result;if(d){const{key:h,value:f}=d;this[v]=h,o.push([this[a].keys&&h!==void 0?k(h):void 0,this[a].values&&f!==void 0?k(f):void 0]),o.length<e?d.continue():R(r)}else this[m]=!0}}else{let c,u;const d=()=>{if(c===void 0||u===void 0)return;const h=Math.max(c.length,u.length);h===0||e===1/0?this[m]=!0:this[v]=c[h-1],o.length=h;for(let f=0;f<h;f++){const I=c[f],C=u[f];o[f]=[this[a].keys&&I!==void 0?k(I):void 0,this[a].values&&C!==void 0?k(C):void 0]}R(r)};this[a].keys||e<1/0?i.getAllKeys(s,e<1/0?e:void 0).onsuccess=h=>{c=h.target.result,d()}:(c=[],this.nextTick(d)),this[a].values?i.getAll(s,e<1/0?e:void 0).onsuccess=h=>{u=h.target.result,d()}:(u=[],this.nextTick(d))}r.onabort=()=>{t(r.error||new Error("aborted by user")),t=null},r.oncomplete=()=>{t(null,o),t=null}}_next(e){if(this[y].length>0){const[n,t]=this[y].shift();this.nextTick(e,null,n,t)}else if(this[m])this.nextTick(e);else{let n=Math.min(100,this.limit-this.count);this[w]&&(this[w]=!1,n=1),this._nextv(n,K,(t,s)=>{if(t)return e(t);this[y]=s,this._next(e)})}}_all(e,n){this[w]=!1;const t=this[y].splice(0,this[y].length),s=this.limit-this.count-t.length;if(s<=0)return this.nextTick(n,null,t);this._nextv(s,K,(r,i)=>{if(r)return n(r);t.length>0&&(i=t.concat(i)),n(null,i)})}_seek(e,n){this[w]=!0,this[y]=[],this[m]=!1,this[v]=void 0,this[g]={...this[a]};let t;try{t=L(this[a])}catch{this[m]=!0;return}t!==null&&!t.includes(e)?this[m]=!0:this[a].reverse?this[g].lte=e:this[g].gte=e}};O.Iterator=G;function R(l){typeof l.commit=="function"&&l.commit()}var X=function(e,n,t,s,r){if(s.limit===0)return e.nextTick(r);const i=e.db.transaction([n],"readwrite"),o=i.objectStore(n);let c=0;i.oncomplete=function(){r()},i.onabort=function(){r(i.error||new Error("aborted by user"))};const u=o.openKeyCursor?"openKeyCursor":"openCursor",d=s.reverse?"prev":"next";o[u](t,d).onsuccess=function(h){const f=h.target.result;f&&(o.delete(f.key).onsuccess=function(){(s.limit<=0||++c<s.limit)&&f.continue()})}};const{AbstractLevel:Y}=q,B=$,H=F,{fromCallback:J}=N,{Iterator:Q}=O,A=j,W=X,Z=P,M="level-js-",_=Symbol("idb"),b=Symbol("namePrefix"),p=Symbol("location"),T=Symbol("version"),x=Symbol("store"),E=Symbol("onComplete"),D=Symbol("promise");class z extends Y{constructor(e,n,t){if(typeof n=="function"||typeof t=="function")throw new B("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:s,version:r,...i}=n||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},i),typeof e!="string")throw new Error("constructor requires a location string argument");this[p]=e,this[b]=s??M,this[T]=parseInt(r||1,10),this[_]=null}get location(){return this[p]}get namePrefix(){return this[b]}get version(){return this[T]}get db(){return this[_]}get type(){return"browser-level"}_open(e,n){const t=indexedDB.open(this[b]+this[p],this[T]);t.onerror=function(){n(t.error||new Error("unknown error"))},t.onsuccess=()=>{this[_]=t.result,n()},t.onupgradeneeded=s=>{const r=s.target.result;r.objectStoreNames.contains(this[p])||r.createObjectStore(this[p])}}[x](e){return this[_].transaction([this[p]],e).objectStore(this[p])}[E](e,n){const t=e.transaction;t.onabort=function(){n(t.error||new Error("aborted by user"))},t.oncomplete=function(){n(null,e.result)}}_get(e,n,t){const s=this[x]("readonly");let r;try{r=s.get(e)}catch(i){return this.nextTick(t,i)}this[E](r,function(i,o){if(i)return t(i);if(o===void 0)return t(new B("Entry not found",{code:"LEVEL_NOT_FOUND"}));t(null,A(o))})}_getMany(e,n,t){const s=this[x]("readonly"),r=e.map(i=>o=>{let c;try{c=s.get(i)}catch(u){return o(u)}c.onsuccess=()=>{const u=c.result;o(null,u===void 0?u:A(u))},c.onerror=u=>{u.stopPropagation(),o(c.error)}});H(r,16,t)}_del(e,n,t){const s=this[x]("readwrite");let r;try{r=s.delete(e)}catch(i){return this.nextTick(t,i)}this[E](r,t)}_put(e,n,t,s){const r=this[x]("readwrite");let i;try{i=r.put(n,e)}catch(o){return this.nextTick(s,o)}this[E](i,s)}_iterator(e){return new Q(this,this[p],e)}_batch(e,n,t){const s=this[x]("readwrite"),r=s.transaction;let i=0,o;r.onabort=function(){t(o||r.error||new Error("aborted by user"))},r.oncomplete=function(){t()};function c(){const u=e[i++],d=u.key;let h;try{h=u.type==="del"?s.delete(d):s.put(u.value,d)}catch(f){o=f,r.abort();return}i<e.length?h.onsuccess=c:typeof r.commit=="function"&&r.commit()}c()}_clear(e,n){let t,s;try{t=Z(e)}catch{return this.nextTick(n)}if(e.limit>=0)return W(this,this[p],t,e,n);try{const r=this[x]("readwrite");s=t?r.delete(t):r.clear()}catch(r){return this.nextTick(n,r)}this[E](s,n)}_close(e){this[_].close(),this.nextTick(e)}}z.destroy=function(l,e,n){typeof e=="function"&&(n=e,e=M),n=J(n,D);const t=indexedDB.deleteDatabase(e+l);return t.onsuccess=function(){n()},t.onerror=function(s){n(s)},n[D]};
